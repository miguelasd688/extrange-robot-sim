


# Project structure

* Root directory is structured as follows

    ```text
    |-- IsaacLab
    |   |-- _isaac_sim -> /isaac-sim
    |   |-- apps
    |   |-- docker
    |   |-- docs
    |   |-- scripts
    |   |-- source
    |   `-- tools
    |-- entrenamientos_funny
    |   |-- 2025-06-15_01-41-56_extrange_run
    |   |-- helicoptero_2025-06-15_20-45-50_extrange_run
    |   `-- incando_cabeza_2025-06-15_01-09-35_extrange_run
    |-- extrange_robot
    |   |-- configs
    |   |-- logs
    |   |-- outputs
    |   |-- scripts
    |   `-- source
    |-- isaac-sim_scripts
    `-- source
    ```

    * IsaacLab/ -> isaaclab installation directory
    * source/ -> generated by isaaclab installation, not used
    * extrange_robot/ -> sources of the Isaac Lab asset
    * isaac-sim_scripts/ -> standalone examples (not maintained)

    ## Asset structure

    Inside /extrange_robot directory:

    ```text
    |-- README.md
    |-- configs
    |   `-- ExtrangeRobotPPO.yaml
    |-- launch.sh # script to launch train and play commands
    |-- logs # Log files and training traces (Hydra, TensorBoard, etc.)
    |-- outputs # Hydra output directories (auto-generated)
    |-- scripts # directory to store the different RL models. I included all at first
    |   |-- list_envs.py
    |   |-- random_agent.py
    |   |-- rl_games
    |   |   |-- play.py
    |   |   `-- train.py
    |   |-- rsl_rl
    |   |   |-- cli_args.py
    |   |   |-- play.py
    |   |   `-- train.py
    |   |-- sb3
    |   |   |-- play.py
    |   |   `-- train.py
    |   |-- skrl
    |   |   |-- play.py
    |   |   `-- train.py
    |   `-- zero_agent.py
    `-- source
        `-- extrange_robot
            |-- assets # robot definition
            |   `-- usd
            |       |-- assembly
            |       |   `-- wheel.usd
            |       |-- configuration
            |       |   |-- extrange-robot_base.usd
            |       |   |-- extrange-robot_physics.usd
            |       |   `-- extrange-robot_sensor.usd
            |       `-- extrange-robot.usd
            |-- config
            |   `-- extension.toml
            |-- docs
            |   `-- CHANGELOG.rst
            |-- extrange_robot
            |   |-- __init__.py
            |   |-- tasks
            |   |   |-- __init__.py
            |   |   `-- direct
            |   |       |-- __init__.py
            |   |       `-- extrange_robot
            |   |           |-- __init__.py
            |   |           |-- agents
            |   |           |   |-- __init__.py
            |   |           |   |-- rl_games_ppo_cfg.yaml
            |   |           |   |-- rsl_rl_ppo_cfg.py
            |   |           |   |-- sb3_ppo_cfg.yaml
            |   |           |   `-- skrl_ppo_cfg.yaml
            |   |           |-- extrange_robot_cfg.py # robot configuration
            |   |           |-- extrange_robot_env.py # environment instance
            |   |           |-- extrange_robot_env_cfg.py # environment configuration
            |   |           `-- extrange_robot_rewards.py # reward function definition
            |   `-- ui_extension_example.py
            |-- extrange_robot.egg-info
            |   |-- PKG-INFO
            |   |-- SOURCES.txt
            |   |-- dependency_links.txt
            |   |-- not-zip-safe
            |   |-- requires.txt
            |   `-- top_level.txt
            |-- pyproject.toml
            `-- setup.py
    ```

    For more information for working with the asset, please, refer to the [README.md](extrange_robot/README.md) file inside the the asset.


# Set up

Host OS:

* Ubuntu 24.04.2 LTS
* Docker version 28.2.2
* NVIDIA Container Runtime Hook version 1.17.8

    commit: f202b80a9b9d0db00d9b1d73c0128c8962c55f4d
* VScode version 1.101.1

Hardware: 
    
* CPU: AMD Ryzen™ 7 5800X × 16
* GPU: NVIDIA GeForce RTX™ 3060
* GPU drivers: NVIDIA driver metapackage from nvidia-driver-570

# Performace

For my setup I observed the following behaviours: 

1. Starting the container takes lot of time to download and build all the images (15Gb). Be patient

2. First time isaac-sim GUI openning takes lot of time (~10 mins). If no error arrise, don't worry just be patient. Don't worry about the pop up saying isaac-sim is not responding.

3. Once images are downloaded and built and isaac-sim is cached, start the environment takes just seconds. 

# Run

1. Enable xhost for GUI fordwarding

    You have to do this every new session.

    ```bash
    xhost +local:root
    ```

2. Open the repo root folder in a Dev Contaier in VScode

3. Test isaac sim works

    ```bash
    /isaac-sim/isaac-sim.selector.sh --allow-root
    ```

3. I created an Isaac Lab asset with

    ref: https://isaac-sim.github.io/IsaacLab/main/source/setup/quickstart.html#

    ```bash
    ./isaaclab.sh --new
    # install the new asset into the Isaac Lab framework
    python -m pip install -e ../extrange_robot/source/extrange_robot/

    ```


3. Start running a single robot without RL agent

    ```bash
    python scripts/zero_agent.py --task=Template-Extrange-Robot-Direct-v0 --rendering_mode=performance
    ```

4. Execute trainning and play

    ```bash
    python scripts/rsl_rl/train.py \
        --task Template-Extrange-Robot-Direct-v0 \
        --num_envs 2000 \
        --headless \
        --run_name extrange_run \
        --max_iterations 301 \
        --load_run 2025-06-15_00-56-20_extrange_run \
        --resume

    python scripts/rsl_rl/play.py \
        --task Template-Extrange-Robot-Direct-v0 \
        --checkpoint logs/rsl_rl/extrange_robot_ppo/2025-06-15_00-56-20_extrange_run/model_300.pt
    ```

    Y developed an script to avoid running the commands all time:

    ```bash
    # start a new trainning
    ./launch.sh train new
    # resume trainning from last available checkpoint
    ./launch.sh train resume

    # play from last checkpoint 
    ./launch.sh play last
    # play a specific checkpoint. Relative path.
    ./launch.sh play logs/rsl_rl/extrange_robot_ppo/2025-06-22_11-46-25_extrange_run/model_1300.pt
    ```



# Installing the environment
ref: https://isaac-sim.github.io/IsaacLab/main/source/deployment/docker.html

1. install docker

    ``` bash
    sudo apt-get update
    sudo apt-get install ca-certificates curl
    sudo install -m 0755 -d /etc/apt/keyrings
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    sudo chmod a+r /etc/apt/keyrings/docker.asc

    # Add the repository to Apt sources:
    echo   "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
    $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}") stable" |   sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

    sudo apt-get update

    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    sudo docker run hello-world
    ```

    ``` bash
    sudo groupadd docker

    sudo usermod -aG docker $USER
    ```

2. Install NVIDIA Container Toolkit for hardware acceleration
    
    ref: https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html
    [No CUDA installation is needed in host]


    ``` bash
    curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg     && curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list |     sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' |     sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list     &&     sudo apt-get update
    40  sudo apt-get install -y nvidia-container-toolkit
    41  sudo systemctl restart docker
    42  sudo nvidia-ctk runtime configure --runtime=docker
    43  sudo systemctl restart docker
    44  docker run --rm --runtime=nvidia --gpus all ubuntu nvidia-smi
    ```

3. To initizalize GUI:

    You have to run this command at the host sistem in every new session you open.

    ``` bash
    xhost +local:root
    ```

4. Open Dev Container in VScode

4. Test isaac-lab image

    In the container, run: 

    ``` bash

    ./isaaclab.sh -p scripts/tutorials/00_sim/log_time.py

    ```

















# Local isaac sim install (Ubuntu 22). Not recommended:

1. First make sure cuda is installed

2. Install isaac lab, it contains isaac sim.

    Conda is recommended to install the isaac lab environment
    ``` bash
    conda create -n env_isaaclab python=3.10
    conda activate env_isaaclab
    pip install torch==2.5.1 torchvision==0.20.1 --index-url https://download.pytorch.org/whl/cu118
    pip install --upgrade pip
    pip install isaaclab[isaacsim,all]==2.1.0 --extra-index-url https://pypi.nvidia.com


    install isaac lab

    git clone https://github.com/isaac-sim/IsaacLab.git
    sudo apt install cmake build-essential
    ./IsaacLab/isaaclab.sh --install

    verify

    ./IsaacLab/isaaclab.sh scripts/tutorials/00_sim/create_empty.py


    Enable cache at isaac sim:
    ./IsaacLab/isaaclab.sh -s
    ```




run isaac sim scritps:

source ~/isaacsim/setup_python_env.sh

./run.sh urdf_import.py



    